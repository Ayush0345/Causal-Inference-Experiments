# -*- coding: utf-8 -*-
"""HW4RD.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1VAU1e64np2O5ReGyctjXus8cub6RqZAT
"""

import pandas as pd
import numpy as np
import statsmodels.api as sm
from itertools import combinations
import matplotlib.pyplot as plt

hansen = '/content/hansen.csv'
data = pd.read_csv(hansen)

"""Create treatment variable 'dui'"""

treatment = (data['bac1'] >= 0.15).astype(int)
data['dui'] = treatment

data['bac1_orig'] = data['bac1']
bac1 = data['bac1'] - 0.15
data['bac1'] = bac1

plt.hist(data['bac1'], bins=10, color='green', edgecolor='yellow')
plt.xlabel('BAC1 Values')
plt.ylabel('Frequency')
plt.title('Centered BAC1 Histogram')
plt.show()

"""RD Regression"""

covariates = pd.DataFrame({
    'white': data['white'],
    'aged' : data['aged'],
    'acc'  : data['acc'],
    'male' : data['male']
})

for covariate in covariates:

  X = data['dui']
  Y = covariates[covariate]

  model = sm.WLS(X, Y).fit()

  print(model.summary())

"""**Test balance at cutoff**

RD Robust model
"""

pip install rdrobust

from rdrobust import rdrobust, rdplot

rdplot(y=data['recidivism'], x=data['bac1'], binselect="esmv", ci=95,
         title="RD Plot: Recidivism",
         y_label="Recidivism",
         x_label="Running Variable")

print(rdrobust(y=data['recidivism'], x=data['bac1']))